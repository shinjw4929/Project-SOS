# 코드베이스 구조

> 이 문서는 Project-SOS의 상세 폴더 구조를 정의합니다.
> 네이밍 패턴 요약은 [CLAUDE.md](../CLAUDE.md#폴더-구조-및-네이밍-패턴)를 참조하세요.

## 폴더 구조

```
Client/
├── Component/
│   ├── Catalog/
│   │   ├── StructurePrefabIndexMap.cs       # 건물 프리팹 인덱스 맵
│   │   └── UnitPrefabIndexMap.cs            # 유닛 프리팹 인덱스 맵
│   ├── Singleton/
│   │   ├── CameraState.cs                   # 카메라 상태 싱글톤
│   │   ├── NotificationState.cs             # 서버 알림 상태 싱글톤
│   │   ├── SelectedEntityInfoState.cs       # 현재 선택된 엔티티 정보 싱글톤
│   │   ├── UserSelectionInputState.cs       # 유저 선택 입력 상태 (Phase 기반)
│   │   └── UserState.cs                     # 유저 컨텍스트 (Command/BuildMenu/Construction/StructureActionMenu)
│   └── Structures/
│       └── StructurePreviewState.cs         # 건설 프리뷰 상태
├── Controller/
│   ├── Camera/
│   │   └── CameraSystem.cs                  # 카메라 이동 시스템
│   ├── StructurePreviewController.cs        # 건설 프리뷰 GameObject 컨트롤러
│   └── UI/
│       ├── Commands/
│       │   ├── CommandButton.cs             # 재사용 커맨드 버튼 컴포넌트
│       │   ├── SelectionBoxRenderer.cs      # 드래그 박스 렌더링
│       │   ├── StructureCommandUIController.cs  # 건물 명령 UI (통합)
│       │   └── UnitCommandUIController.cs   # 유닛 명령 UI (통합)
│       ├── Cursor/
│       │   └── TestCursorController.cs      # 테스트 커서 컨트롤러
│       ├── Info/
│       │   ├── EntityInfoRenderer.cs        # 엔티티 정보 UI
│       │   └── UserResourceInfoRenderer.cs  # 유저 경제 UI 렌더러
│       └── ToastNotificationController.cs   # 토스트 알림 UI
├── Systems/
│   ├── Combat/
│   │   ├── ClientDeathSystem.cs             # 클라이언트 사망 처리
│   │   └── ProjectileVisualSystem.cs        # 투사체 시각 효과 시스템 (Ghost 복제 투사체 이동)
│   ├── Commands/
│   │   ├── Construction/
│   │   │   ├── ConstructionMenuInputSystem.cs   # Q키 건설 메뉴 (BuildSelectionUtility 사용)
│   │   │   ├── StructurePlacementInputSystem.cs # 건설 배치 입력 (BuildRequestRpc/BuildMoveRequestRpc 전송)
│   │   │   └── StructurePreviewUpdateSystem.cs  # 프리뷰 업데이트
│   │   ├── Selection/
│   │   │   ├── EntitySelectionSystem.cs     # Selected 컴포넌트 토글
│   │   │   ├── SelectedEntityInfoUpdateSystem.cs  # 선택된 엔티티 정보 업데이트
│   │   │   ├── SelectionRingSpawnSystem.cs  # 선택 링 스폰 시스템
│   │   │   ├── SelectionVisualizationSystem.cs
│   │   │   └── UserSelectionInputUpdateSystem.cs  # 마우스 입력 → Phase 업데이트
│   │   ├── StructureAction/
│   │   │   └── StructureCommandInputSystem.cs   # 건물 명령 입력 (생산/자폭)
│   │   └── UnitControl/
│   │       └── UnitCommandInputSystem.cs    # 유닛 명령 RPC 전송 (MoveRequestRpc/AttackRequestRpc)
│   ├── HeroHpTextPresentationSystem.cs      # 영웅 HP 텍스트 프레젠테이션
│   ├── Initialize/
│   │   ├── CatalogIndexMapInitSystem.cs     # 카탈로그 인덱스 맵 초기화
│   │   ├── ClientBootstrapSystem.cs         # 클라이언트 초기화
│   │   └── GoInGameClientSystem.cs          # 게임 진입 클라이언트
│   └── NotificationReceiveSystem.cs         # 서버 알림 RPC 수신
├── UI/
│   ├── Enemy/
│   │   ├── EnemyHpTextPresentationSystem.cs # 적 HP 텍스트 프레젠테이션
│   │   └── EnemyHpUIBridge.cs               # 적 HP UI 브릿지
│   └── HeroHpTextManager.cs                 # 영웅 HP 텍스트 매니저
└── Utilities/
    ├── BuildSelectionUtility.cs             # 건설 명령 공통 유틸리티
    └── ProduceSelectionUtility.cs           # 생산 명령 공통 유틸리티

Shared/
├── Buffers/
│   ├── DamageEvent.cs                       # 데미지 이벤트 버퍼 (지연 데미지 적용)
│   ├── EntityCatalog.cs                     # 엔티티 카탈로그 버퍼
│   ├── GridCell.cs                          # 그리드 셀 버퍼
│   ├── PathWaypoint.cs                      # 경로 웨이포인트 버퍼
│   └── StructurePrefabStore.cs              # 건물 프리팹 저장소
├── SystemGroups/
│   └── SpatialPartitioningGroup.cs          # 공간 분할 시스템 전용 그룹
├── Components/
│   ├── ContactDamage.cs                     # 접촉 데미지 컴포넌트
│   ├── HeroHealth.cs                        # 영웅 체력 컴포넌트
│   ├── Data/
│   │   ├── EnemyChaseDistance.cs            # 적 추적 거리
│   │   ├── EnemySpawnPoint.cs               # 적 스폰 포인트 위치
│   │   ├── ExplosionData.cs                 # 폭발 데이터
│   │   ├── GridOccupancyCleanup.cs
│   │   ├── GridPosition.cs
│   │   ├── NavMeshObstacleProxy.cs          # NavMesh 장애물 프록시
│   │   ├── ProductionInfo.cs
│   │   ├── ProductionQueue.cs
│   │   ├── ProjectileMove.cs                # 투사체 이동
│   │   ├── UserCurrency.cs
│   │   ├── UserPopulation.cs
│   │   └── UserTechState.cs                 # 유저 기술 상태
│   ├── Flags/
│   │   └── SelectedTag.cs                   # Selected (EnableableComponent)
│   ├── Inputs/
│   │   └── UnitCommand.cs                   # 유닛 명령 입력
│   ├── Movement/
│   │   ├── MovementDynamics.cs              # 이동 역학 (속도, 가속도)
│   │   ├── MovementGoal.cs                  # 이동 목표
│   │   ├── MovementWaypoints.cs             # 이동 웨이포인트
│   │   └── NavMeshAgentConfig.cs            # NavMesh 에이전트 설정
│   ├── Selection/
│   │   ├── SelectionRingLinked.cs           # 선택 링 연결 태그
│   │   ├── SelectionRingOwner.cs            # 선택 링 소유자
│   │   └── SelectionRingTag.cs              # 선택 링 태그
│   ├── State/
│   │   ├── AggroTarget.cs                   # 공격/추적 대상 (유닛/적 공통)
│   │   ├── AttackCooldown.cs                # 공격 쿨다운 타이머
│   │   ├── CarriedResourceOwner.cs          # 운반 자원 소유자 (Worker 참조)
│   │   ├── ConstructionState.cs
│   │   ├── EnemyState.cs                    # 적 상태
│   │   ├── GatheringTarget.cs               # 자원 채집 타겟
│   │   ├── InitialWallDecayTimer.cs         # 초기 벽 붕괴 타이머
│   │   ├── ResourceNodeState.cs             # 자원 노드 상태
│   │   ├── StructureState.cs
│   │   ├── UnitActionState.cs               # 유닛 액션 상태
│   │   ├── UnitIntentState.cs               # 유닛 의도 상태
│   │   ├── WorkerState.cs                   # 일꾼 상태 (CarriedAmount, GatherPhase)
│   │   └── SpawnStunTimer.cs                # 스폰 후 경직 타이머
│   ├── Stats/
│   │   ├── CombatStats.cs
│   │   ├── Defense.cs
│   │   ├── GatheringAbility.cs              # 자원 채집 능력
│   │   ├── Health.cs
│   │   ├── ObstacleRadius.cs                # 장애물 반경
│   │   ├── ProductionCost.cs
│   │   ├── ResourceNodeSetting.cs           # 자원 노드 설정
│   │   ├── StructureFootprint.cs
│   │   ├── VisionRange.cs
│   │   └── WorkRange.cs                     # 작업 사거리
│   └── Tags/
│       ├── CarriedResourceTag.cs            # 운반 자원 태그
│       ├── IdentityTags.cs                  # UnitTag, StructureTag
│       ├── InitialWallTag.cs                # 초기 벽 태그
│       ├── RangedEnemyTag.cs                # 원거리 적 태그 (EnemyFlying)
│       ├── RangedUnitTag.cs                 # 원거리 유닛 태그 (Trooper, Sniper)
│       ├── SelfDestructTag.cs               # 자폭 태그
│       ├── StructureTypeTags.cs             # WallTag, ProductionFacilityTag, ResourceCenterTag 등
│       ├── Team.cs                          # 팀 태그
│       ├── UnitTypeTags.cs                  # HeroTag, WorkerTag, BuilderTag, SwordsmanTag, TrooperTag, SniperTag 등
│       ├── UserEconomyTag.cs                # 유저 경제 엔티티 태그
│       └── VisualOnlyTag.cs                 # 시각 전용 태그 (데미지 없는 투사체)
├── GhostVariants/
│   └── PhysicsVelocityGhostOverride.cs      # Physics Velocity Ghost 오버라이드
├── RPCs/
│   ├── AttackRequestRpc.cs                  # 공격 명령 RPC (Reliable)
│   ├── BuildMoveRequestRpc.cs               # 건설 이동 명령 RPC (사거리 밖 건설)
│   ├── BuildRequestRpc.cs                   # 건설 요청 RPC (사거리 내 즉시 건설)
│   ├── FireProjectileRpc.cs                 # [미사용] 투사체 발사 요청 RPC
│   ├── GatherRequestRpc.cs                  # 자원 채집 요청 RPC
│   ├── GoInGameRequestRpc.cs                # 게임 진입 요청 RPC
│   ├── MoveRequestRpc.cs                    # 이동 명령 RPC (Reliable)
│   ├── NotificationRpc.cs                   # 서버 알림 RPC (자원 부족 등)
│   ├── ProduceUnitRequestRpc.cs             # 유닛 생산 요청 RPC
│   ├── ProjectileVisualRpc.cs               # [미사용] 투사체 시각 효과 RPC
│   ├── ReturnResourceRequestRpc.cs          # 자원 반납 요청 RPC
│   └── SelfDestructRequestRpc.cs            # 자폭 요청 RPC
├── Singletons/
│   ├── CameraSettings.cs                    # 카메라 설정 싱글톤
│   ├── GamePhaseState.cs                    # Wave 상태 싱글톤 (WavePhase, ElapsedTime, TotalKillCount)
│   ├── GameSettings.cs                      # 게임 설정 싱글톤 (Wave 전환 조건 포함)
│   ├── GhostIdMap.cs                        # Ghost ID 맵 싱글톤
│   ├── GridSettings.cs
│   ├── SpatialMaps.cs                       # 공간 분할 맵 싱글톤 (TargetingMap, MovementMap)
│   └── Ref/
│       ├── CarriedResourcePrefabRef.cs      # 운반 자원 프리팹 참조
│       ├── EnemyPrefabCatalog.cs            # 적 프리팹 카탈로그 (명시적 필드: Small/Big/Flying)
│       ├── EnemyPrefabRef.cs                # [Deprecated] 적 프리팹 참조
│       ├── ProjectilePrefabRef.cs           # 투사체 프리팹 참조
│       ├── ResourceNodePrefabRef.cs         # 자원 노드 프리팹 참조
│       ├── SelectionRingPrefabRef.cs        # 선택 링 프리팹 참조
│       └── UserEconomyPrefabRef.cs          # 유저 경제 프리팹 참조
├── Systems/
│   ├── CarriedResourceFollowSystem.cs       # 운반 자원 위치/가시성 (Scale 토글)
│   ├── Combats/
│   │   └── ProjectileMoveSystem.cs          # 투사체 이동 시스템
│   ├── Enemy/
│   │   └── EnemyTargetSystem.cs             # [Deprecated] 적 타겟 시스템 → UnifiedTargetingSystem으로 통합
│   ├── Grid/
│   │   ├── GridOccupancyEventSystem.cs
│   │   └── ObstacleGridInitSystem.cs        # 장애물 그리드 초기화 시스템
│   └── Utils/
│       └── GhostIdLookupSystem.cs           # Ghost ID 조회 시스템
└── Utilities/
    ├── DamageUtility.cs                     # 데미지 계산 유틸리티
    ├── GridUtility.cs                       # 그리드 유틸리티
    ├── MovementMath.cs                      # 이동 계산 유틸리티 (가속/감속)
    └── SpatialHashUtility.cs                # 공간 분할 해시 유틸리티 (셀 크기, 해시 계산, AABB)

Server/
├── Data/
│   ├── BuildActionRequest.cs                # 건설 액션 요청 데이터
│   └── PendingBuildServerData.cs            # 서버 전용 대기 건설 데이터 (이동 후 건설)
├── GoInGameServerSystem.cs
└── Systems/
    ├── Combat/
    │   ├── CombatDamageSystem.cs            # 투사체 충돌 데미지 시스템 (Physics Trigger, VisualOnlyTag 제외)
    │   ├── DamageApplySystem.cs             # 데미지 적용 시스템 (버퍼 → Health)
    │   ├── MeleeAttackSystem.cs             # 근접 공격 시스템 (거리 기반, RangedUnitTag 제외)
    │   ├── RangedAttackSystem.cs            # 원거리 공격 시스템 (필중, 시각 투사체 생성)
    │   ├── ServerDeathSystem.cs             # 서버 사망 처리
    │   ├── UnitAutoTargetSystem.cs          # [Deprecated] 유닛 자동 타겟팅 → UnifiedTargetingSystem으로 통합
    │   └── UnifiedTargetingSystem.cs        # 통합 타겟팅 시스템 (적→아군, 유닛→적)
    ├── Commands/
    │   ├── Combat/
    │   │   └── HandleAttackRequestSystem.cs        # 공격 명령 RPC 처리
    │   ├── Construction/
    │   │   ├── BuildArrivalSystem.cs               # 건설 도착 시스템 (도착 시 건물 생성)
    │   │   ├── HandleBuildMoveRequestSystem.cs     # 건설 이동 명령 RPC 처리
    │   │   └── HandleBuildRequestSystem.cs         # 건설 요청 RPC 처리 (사거리 내)
    │   ├── Gathering/
    │   │   ├── HandleGatherRequestSystem.cs         # 자원 채집 요청 처리
    │   │   └── HandleReturnResourceRequestSystem.cs # 자원 반납 요청 처리
    │   ├── Movement/
    │   │   └── HandleMoveRequestSystem.cs          # 이동 명령 RPC 처리
    │   ├── Production/
    │   │   ├── HandleProduceUnitRequestSystem.cs    # 유닛 생산 요청 처리
    │   │   └── ProductionProgressSystem.cs          # 생산 진행 시스템
    │   └── Structure/
    │       ├── HandleSelfDestructRequestSystem.cs  # 자폭 요청 처리
    │       └── SelfDestructTimerSystem.cs          # 자폭 타이머
    ├── FireProjectileServerSystem.cs        # 투사체 발사 (서버)
    ├── Gathering/
    │   ├── ResourceNodeCleanupSystem.cs     # 자원 노드 정리 시스템
    │   ├── WorkerCarriedResourceSpawnSystem.cs  # Worker 스폰 시 CarriedResource 자동 생성
    │   └── WorkerGatheringSystem.cs         # 일꾼 자원 채집 시스템
    ├── HeroDamageOnContactServerSystem.cs   # 영웅 접촉 데미지 시스템
    ├── Initialize/
    │   └── GamePhaseInitSystem.cs           # GamePhaseState 싱글톤 초기화
    ├── InitialWallDecaySystem.cs            # 초기 벽 붕괴 시스템
    ├── Movement/
    │   ├── MovementArrivalSystem.cs         # 이동 도착 처리 (서버 전용)
    │   ├── NavMeshObstacleCleanupSystem.cs  # NavMesh 장애물 정리
    │   ├── NavMeshObstacleSpawnSystem.cs    # NavMesh 장애물 생성
    │   ├── PathfindingSystem.cs             # Pathfinding 시스템
    │   ├── PathFollowSystem.cs              # 경로 추적 시스템
    │   └── PredictedMovementSystem.cs       # 유닛 이동 시스템 (SpatialMaps.MovementMap 사용)
    ├── Spatial/
    │   ├── SpatialMapBuildSystem.cs         # 공간 분할 맵 빌드 (TargetingMap + MovementMap)
    │   └── SpatialMapDisposeSystem.cs       # 공간 분할 맵 해제 (LateSimulation)
    ├── TechStateRecalculateSystem.cs        # 기술 상태 재계산 시스템
    └── Wave/
        ├── EnemyDeathCountSystem.cs         # 적 처치 수 카운팅 (ServerDeathSystem 전)
        ├── EnemySpawnerSystem.cs            # Wave별 적 스폰 시스템
        └── WaveManagerSystem.cs             # Wave 전환 조건 체크

Authoring/
├── CatalogAndRef/
│   ├── CarriedResourcePrefabRefAuthoring.cs # 운반 자원 프리팹 참조
│   ├── EnemyPrefabCatalogAuthoring.cs       # 적 프리팹 카탈로그 (명시적 필드, 순서 무관)
│   ├── EnemyPrefabRefAuthoring.cs           # [Deprecated] 적 프리팹 참조
│   ├── ProjectilePrefabRefAuthoring.cs      # 투사체 프리팹 참조
│   ├── ResourceNodePrefabRefAuthoring.cs    # 자원 노드 프리팹 참조
│   ├── StructureCatalogAuthoring.cs         # 건물 카탈로그
│   ├── UnitCatalogAuthoring.cs              # 유닛 카탈로그
│   └── UserEconomyPrefabRefAuthoring.cs     # 유저 경제 프리팹 참조 싱글톤
├── Combat/
│   └── ProjectileAuthoring.cs               # 투사체 오서링
├── Components/
│   └── SelectedAuthoring.cs                 # Selected 태그 오서링
├── Economy/
│   └── UserEconomyAuthoring.cs              # 유저 경제 오서링 (Ghost 프리팹용)
├── Enemies/
│   └── ContactDamageAuthoring.cs            # 접촉 데미지 오서링
├── Entities/
│   ├── CarriedResourceAuthoring.cs          # 운반 자원 오서링
│   ├── EnemyAuthoring.cs                    # 적 오서링 (스탯/전투, 이동은 MovementAuthoring)
│   ├── ResourceNodeAuthoring.cs             # 자원 노드 오서링
│   ├── StructureAuthoring.cs                # 건물 오서링 (Wall/Barracks/Turret/ResourceCenter)
│   └── UnitAuthoring.cs                     # 유닛 오서링 (스탯/전투/정체성)
├── Movement/
│   ├── MovementAuthoring.cs                 # 공용 이동 오서링 (MovementDynamics, NavMesh 등)
│   └── UnitMovementAuthoring.cs             # 유닛 전용 명령/상태 오서링 (UnitIntentState, UnitCommand)
├── Selection/
│   ├── SelectionRingAuthoring.cs            # 선택 링 오서링
│   └── SelectionRingPrefabRefAuthoring.cs   # 선택 링 프리팹 참조 오서링
└── Settings/
    ├── CameraSettingsAuthoring.cs           # 카메라 설정 오서링
    ├── EnemySpawnPointAuthoring.cs          # 적 스폰 포인트 위치 지정
    ├── GameSettingsAuthoring.cs             # 게임 설정 (Wave 포함)
    └── GridSettingsAuthoring.cs

Root (Scripts)/
└── GameBootStrap.cs                         # 게임 진입점

Tests/
├── EditMode/
│   ├── EditModeTests.asmdef                 # Edit 모드 테스트 어셈블리
│   └── Utilities/
│       ├── DamageUtilityTests.cs            # DamageUtility 단위 테스트
│       ├── GridUtilityTests.cs              # GridUtility 단위 테스트
│       └── MovementCalculationTests.cs      # MovementMath 단위 테스트
└── PlayMode/
    ├── PlayModeTests.asmdef                 # Play 모드 테스트 어셈블리
    ├── ECSTestBase.cs                       # ECS 테스트 베이스 클래스
    └── Systems/
        ├── DamageApplySystemTests.cs        # DamageApplySystem 통합 테스트
        ├── MovementSystemTests.cs           # 이동 시스템 통합 테스트
        └── WaveSystemTests.cs               # Wave 시스템 통합 테스트
```
